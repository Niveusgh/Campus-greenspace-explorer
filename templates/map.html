{% extends "base.html" %}

{% block extra_css %}
<style>
    .map-container {
        background-color: #222;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 60px; /* Account for fixed footer */
    }

    .map-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .layer-toggle {
        padding: 8px 16px;
        background: #558B6E;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .layer-toggle.active {
        background: #3A5E4A;
    }

    .layer-toggle:hover {
        background: #446F58;
    }

    .map-layers {
        position: relative;
        background: #2A2A2A;
        border-radius: 4px;
        overflow: hidden;
        min-height: 500px;
    }

    .map-layers svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .info-panel {
        background: #2A2A2A;
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
        color: #C7C4BF;
    }

    .info-panel h3 {
        color: #558B6E;
        margin-bottom: 10px;
    }

    /* Make SVG elements interactive */
    path, polygon {
        cursor: pointer;
        transition: fill 0.3s;
    }

    path:hover, polygon:hover {
        fill: #558B6E;
        opacity: 0.7;
    }

    /* Responsive design */
    @media (max-width: 600px) {
        .map-controls {
            flex-direction: column;
        }
        
        .layer-toggle {
            width: 100%;
            text-align: center;
        }

        .map-layers {
            min-height: 300px;
        }
    }
</style>
{% endblock %}

{% block content %}
<section id="map-view">
    <h2>Campus Map</h2>
    <div class="map-container">
        <div class="map-controls">
            <button class="layer-toggle active" data-layer="buildings">Buildings</button>
            <button class="layer-toggle active" data-layer="spaces">Green Spaces</button>
            <button class="layer-toggle active" data-layer="paths">Paths</button>
        </div>
        
        <div class="map-layers">
            <!-- SVGs will be loaded here -->
        </div>

        <div class="info-panel">
            <h3>Location Information</h3>
            <p>Click on any area of the map to learn more about it.</p>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mapLayers = document.querySelector('.map-layers');
    const infoPanel = document.querySelector('.info-panel');
    
    // Load SVGs
    const svgFiles = {
        buildings: "{{ url_for('static', filename='images/map/Buildings.svg') }}",
        spaces: "{{ url_for('static', filename='images/map/Green Spaces.svg') }}",
        paths: "{{ url_for('static', filename='images/map/Paths.svg') }}"
    };

    // Load each SVG file
    Object.entries(svgFiles).forEach(([key, path]) => {
        fetch(path)
            .then(response => response.text())
            .then(svgContent => {
                const div = document.createElement('div');
                div.innerHTML = svgContent;
                const svg = div.querySelector('svg');
                svg.classList.add(`layer-${key}`);
                mapLayers.appendChild(svg);

                // Add click handlers to paths and polygons
                svg.querySelectorAll('path, polygon').forEach(element => {
                    element.addEventListener('click', () => {
                        const name = element.getAttribute('id') || 'Unnamed Location';
                        updateInfoPanel(name);
                    });
                });
            });
    });

    // Toggle layers
    document.querySelectorAll('.layer-toggle').forEach(button => {
        button.addEventListener('click', () => {
            const layer = button.dataset.layer;
            button.classList.toggle('active');
            const svg = document.querySelector(`.layer-${layer}`);
            if (svg) {
                svg.style.display = button.classList.contains('active') ? 'block' : 'none';
            }
        });
    });

    // Location information database
    const locationInfo = {
        'WT Young Library Lawn': {
            description: 'An open space perfect for sunbathing and outdoor studying.',
            features: ['Open Grass Area', 'Study Spots', 'WiFi Access', 'Natural Shade']
        },
        'President Garden': {
            description: 'A serene garden featuring a beautiful lily pond and various native plants.',
            features: ['Lily Pond', 'Native Plants', 'Benches', 'Shade Trees']
        }
        // Add more locations as needed
    };

    function updateInfoPanel(locationName) {
        const info = locationInfo[locationName] || {
            description: 'A beautiful spot on campus.',
            features: ['Green Space']
        };

        infoPanel.innerHTML = `
            <h3>${locationName}</h3>
            <p>${info.description}</p>
            ${info.features.length ? `
                <h4 style="color: #558B6E; margin-top: 10px;">Features:</h4>
                <ul style="list-style-position: inside; margin-top: 5px;">
                    ${info.features.map(f => `<li>${f}</li>`).join('')}
                </ul>
            ` : ''}
        `;
    }
});
</script>
{% endblock %}