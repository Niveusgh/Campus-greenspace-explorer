{% extends "base.html" %}

{% block extra_css %}
<style>
    /* Map controls container */
    .map-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        padding: 5px;
    }

    /* Unselected state */
    .layer-toggle {
        padding: 10px 20px;
        background: #2A2A2A;
        color: #C7C4BF;
        border: 2px solid #558B6E;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    /* Hover state */
    .layer-toggle:hover {
        background: #3A3A3A;
        border-color: #6A9F83;
    }

    /* Selected state */
    .layer-toggle.active {
        background: #558B6E;
        color: white;
        border-color: #558B6E;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Map layers container */
    .map-layers {
        position: relative;
        background: #2A2A2A;
        border-radius: 4px;
        overflow: hidden;
        flex-grow: 1;
    }

    /* Individual SVG layers */
    .map-layers svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .layer-buildings,
    .layer-spaces,
    .layer-paths {
        display: none; /* Hide all layers by default */
    }

    /* Show active layers */
    .layer-buildings.visible,
    .layer-spaces.visible,
    .layer-paths.visible {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="map-container">
    <div class="map-controls">
        <button class="layer-toggle" data-layer="buildings">Buildings</button>
        <button class="layer-toggle" data-layer="spaces">Green Spaces</button>
        <button class="layer-toggle" data-layer="paths">Paths</button>
    </div>
    
    <div class="map-layers">
        <!-- SVGs will be loaded here -->
    </div>

    <div class="info-panel">
        <h3>Select a location</h3>
        <p>Click on any area of the map to learn more about it.</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mapLayers = document.querySelector('.map-layers');
    
    // Load SVGs with proper z-index ordering
    const svgFiles = {
        buildings: "{{ url_for('static', filename='images/map/Buildings.svg') }}",
        spaces: "{{ url_for('static', filename='images/map/Green Spaces.svg') }}",
        paths: "{{ url_for('static', filename='images/map/Paths.svg') }}"
    };

    // Set proper z-index for layers
    const zIndex = {
        paths: 1,
        buildings: 2,
        spaces: 3
    };

    // Load each SVG file
    Object.entries(svgFiles).forEach(([key, path]) => {
        fetch(path)
            .then(response => response.text())
            .then(svgContent => {
                const div = document.createElement('div');
                div.innerHTML = svgContent;
                const svg = div.querySelector('svg');
                svg.classList.add(`layer-${key}`);
                svg.style.zIndex = zIndex[key];
                svg.classList.add('visible'); // Show by default
                mapLayers.appendChild(svg);

                // Add click handlers
                svg.querySelectorAll('path, polygon').forEach(element => {
                    element.addEventListener('click', () => {
                        const name = element.getAttribute('id') || 'Unnamed Location';
                        updateInfoPanel(name);
                    });
                });
            });
    });

    // Improved layer toggle functionality
    document.querySelectorAll('.layer-toggle').forEach(button => {
        button.addEventListener('click', () => {
            const layer = button.dataset.layer;
            button.classList.toggle('active');
            
            const svg = document.querySelector(`.layer-${layer}`);
            if (svg) {
                svg.classList.toggle('visible');
            }
        });
        
        // Set initial state as active
        button.classList.add('active');
    });

    function updateInfoPanel(locationName) {
        const infoPanel = document.querySelector('.info-panel');
        infoPanel.innerHTML = `
            <h3>${locationName}</h3>
            <p>Information about ${locationName}</p>
        `;
    }
});
</script>
{% endblock %}